<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>WebGL - Fundamentals</title>
<link rel="stylesheet" href="./css/tabs.css" type="text/css">
<script src="./js/jquery-2.1.3.min.js" type="text/javascript"></script>
<script src="./js/dygraph-combined.js" type="text/javascript"></script>


<script>
var url = "http://swhv.oma.be/datasets/odi_read_data.php?start_date=2015-01-05&end_date=2015-01-12&timeline=GOES_XRSA_ODI&data_format=json";
fetchData = function(url, data, g){
	var xmlhttp = new XMLHttpRequest();	
	xmlhttp.onreadystatechange = function() {
	    if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
	        var myArr = JSON.parse(xmlhttp.responseText);
	        var newdata = myArr.data;
	        for(var i = 0; i<newdata.length; i++){
	        	data.push([new Date(newdata[i][0]*1000), newdata[i][1]]);
	        }
	        console.log(newdata);
            g.updateOptions( { 'file': data } );
	    }
	}
	xmlhttp.open("GET", url, true);
	xmlhttp.send();
}
function myFunction(arr, data) {
    var out = "";
    var i;
    for(i = 0; i < arr.length; i++) {
        out += '<a href="' + arr[i].url + '">' + 
        arr[i].display + '</a><br>';
    }
    document.getElementById("id01").innerHTML = out;
}
$(document).ready(function () {
      var data = [];
      
      var t = new Date();

      var g = new Dygraph(document.getElementById("div_g"), data,                     {
                            drawPoints: true,
                            //valueRange: [0.0, 1.2],
                            labels: ['Time', 'W/m^2'],
                            
                          });
      // It sucks that these things aren't objects, and we need to store state in window.
      window.intervalId = setInterval(function() {
        var x = new Date();  // current time
        var y = Math.random();
        //data.push([x, y]);
        g.updateOptions( { 'file': data } );
      }, 1000);
      fetchData(url, data, g);

    }
);
 </script> 
</head>
<body>
<div id="div_g" style="width:600px; height:300px;"></div>
<p>This test is modeled after a 
<a href="http://www.highcharts.com/demo/?example=dynamic-update&amp;theme=default">highcharts
test</a>. New points should appear once per second. Try zooming and 
panning over to the right edge to watch them show up.</p>
</body>
</html>