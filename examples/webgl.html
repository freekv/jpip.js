<html>
    <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Communication over jpip demo</title>
    <link rel="stylesheet" href="./css/webgl.css" type="text/css"> 
    <script src="./js/globals.js" type="text/javascript"></script>
    <script src="./js/sylvester.js" type="text/javascript"></script>
    <script src="./js/glUtils.js" type="text/javascript"></script>
    <script src="../src/js/jpip.js" type="text/javascript"></script>
    <script src="./js/solarJPIP.js" type="text/javascript"></script>
    <script src="./js/webgl.js" type="text/javascript"></script>
    <script src="./js/gui.js" type="text/javascript"></script>

    <script id="shader-fs" type="x-shader/x-fragment">
      varying highp vec2 vTextureCoord;
      varying highp vec2 vTextureCoordDiff;

      uniform sampler2D uSampler;
      uniform sampler2D uSamplerDiff;

      uniform sampler2D uColormap;
	  uniform highp float colorTableValue;
	  uniform int isDiff;
      
      void main(void) {
	    if(isDiff==1){
          gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t)) - texture2D(uSamplerDiff, vec2(vTextureCoordDiff.s, vTextureCoordDiff.t));
		  highp float val = clamp((clamp(gl_FragColor.x, -0.5, 0.5)/0.5 + 1.)/2., 0. , 1.);
		  gl_FragColor.xyz = vec3(val,val,val);
		}
        else{
		  gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));
          gl_FragColor = texture2D(uColormap, vec2(gl_FragColor.r, colorTableValue));
		}
        gl_FragColor.a = 1.0;
      }
    </script>
     
    <script id="shader-vs" type="x-shader/x-vertex">
      attribute vec3 aVertexPosition;
      attribute vec2 aTextureCoord;

    
      uniform mat4 uMVMatrix;
      uniform mat4 uPMatrix;
      uniform vec2 center;
      uniform vec2 centerDiff;
      uniform vec2 stretch;
      uniform vec2 stretchDiff;
      
      varying highp vec2 vTextureCoord;
      varying highp vec2 vTextureCoordDiff;
   
      void main(void) {
        gl_Position =  vec4(aVertexPosition , 1.0);
        vTextureCoord = aTextureCoord + vec2(center.x, -center.y);
        vTextureCoordDiff = aTextureCoord + vec2(centerDiff.x, -centerDiff.y);

      }
    </script>
  </head>
  
  <body onload="start()">
  <div id="top" style="clear:both;">
      <div id ="controlpanel">
      </div>  
  </div>

  
  <div style="float:left;">
    <canvas id="glcanvas" width="512" height="512">
      Your browser doesn't appear to support the HTML5 <code>&lt;canvas&gt;</code> element.
    </canvas>
  </div>
  <div id="wrap" style="float:left;">
      <div id="info">
      </div>
      <div id ="imagepanel">
      </div>
      <div id="metadata">
      </div>
      <div id="fps">
      </div>
  </div>
</body>
</html>
